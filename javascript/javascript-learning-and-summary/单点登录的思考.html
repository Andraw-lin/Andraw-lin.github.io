<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>单点登录(SSO)的思考</title>
    <meta name="generator" content="VuePress 1.6.0">
    
    <meta name="description" content="好好学习，天天向上💪">
    <link rel="preload" href="/assets/css/0.styles.a748b10c.css" as="style"><link rel="preload" href="/assets/js/app.62b9dc26.js" as="script"><link rel="preload" href="/assets/js/2.1177bb59.js" as="script"><link rel="preload" href="/assets/js/61.bc1f5260.js" as="script"><link rel="prefetch" href="/assets/js/10.a3eb2dd7.js"><link rel="prefetch" href="/assets/js/100.a0587a90.js"><link rel="prefetch" href="/assets/js/101.bc61ee8e.js"><link rel="prefetch" href="/assets/js/102.6c9a3815.js"><link rel="prefetch" href="/assets/js/103.b27b845c.js"><link rel="prefetch" href="/assets/js/104.66db0c7a.js"><link rel="prefetch" href="/assets/js/105.900b60f5.js"><link rel="prefetch" href="/assets/js/106.9ccab627.js"><link rel="prefetch" href="/assets/js/107.29f88d5b.js"><link rel="prefetch" href="/assets/js/108.7981e08e.js"><link rel="prefetch" href="/assets/js/109.b33024ae.js"><link rel="prefetch" href="/assets/js/11.8bb20b07.js"><link rel="prefetch" href="/assets/js/110.3b0e64b4.js"><link rel="prefetch" href="/assets/js/111.8906ec31.js"><link rel="prefetch" href="/assets/js/112.f2c7dd3a.js"><link rel="prefetch" href="/assets/js/113.4126790c.js"><link rel="prefetch" href="/assets/js/114.f584a619.js"><link rel="prefetch" href="/assets/js/115.aa3ce001.js"><link rel="prefetch" href="/assets/js/116.9fc7b46a.js"><link rel="prefetch" href="/assets/js/117.02392f6b.js"><link rel="prefetch" href="/assets/js/118.be950d41.js"><link rel="prefetch" href="/assets/js/119.12f1724b.js"><link rel="prefetch" href="/assets/js/12.495dead6.js"><link rel="prefetch" href="/assets/js/120.8ec47d18.js"><link rel="prefetch" href="/assets/js/121.59dab4d9.js"><link rel="prefetch" href="/assets/js/122.ba73929a.js"><link rel="prefetch" href="/assets/js/123.f1f96cdb.js"><link rel="prefetch" href="/assets/js/124.e9ee3ab6.js"><link rel="prefetch" href="/assets/js/13.125ff0e3.js"><link rel="prefetch" href="/assets/js/14.638fd70a.js"><link rel="prefetch" href="/assets/js/15.c6414c00.js"><link rel="prefetch" href="/assets/js/16.e5534201.js"><link rel="prefetch" href="/assets/js/17.52920d84.js"><link rel="prefetch" href="/assets/js/18.e348c11a.js"><link rel="prefetch" href="/assets/js/19.3b4ed4a3.js"><link rel="prefetch" href="/assets/js/20.91aa8274.js"><link rel="prefetch" href="/assets/js/21.ef7544cb.js"><link rel="prefetch" href="/assets/js/22.c79ecf29.js"><link rel="prefetch" href="/assets/js/23.d74b8bc0.js"><link rel="prefetch" href="/assets/js/24.e1b7042f.js"><link rel="prefetch" href="/assets/js/25.ee0d54de.js"><link rel="prefetch" href="/assets/js/26.5ce41a17.js"><link rel="prefetch" href="/assets/js/27.506fca63.js"><link rel="prefetch" href="/assets/js/28.9e16b1bc.js"><link rel="prefetch" href="/assets/js/29.5f3fc6bd.js"><link rel="prefetch" href="/assets/js/3.56a9ad25.js"><link rel="prefetch" href="/assets/js/30.0b8b1b94.js"><link rel="prefetch" href="/assets/js/31.f972863c.js"><link rel="prefetch" href="/assets/js/32.58c91d73.js"><link rel="prefetch" href="/assets/js/33.40ec3e53.js"><link rel="prefetch" href="/assets/js/34.e948a627.js"><link rel="prefetch" href="/assets/js/35.89965b4f.js"><link rel="prefetch" href="/assets/js/36.773346af.js"><link rel="prefetch" href="/assets/js/37.8265a7ea.js"><link rel="prefetch" href="/assets/js/38.6814416d.js"><link rel="prefetch" href="/assets/js/39.2b4fe455.js"><link rel="prefetch" href="/assets/js/4.b41e69dd.js"><link rel="prefetch" href="/assets/js/40.fda79697.js"><link rel="prefetch" href="/assets/js/41.868f73f6.js"><link rel="prefetch" href="/assets/js/42.252a1ee9.js"><link rel="prefetch" href="/assets/js/43.4776516f.js"><link rel="prefetch" href="/assets/js/44.46eab99f.js"><link rel="prefetch" href="/assets/js/45.30564ad8.js"><link rel="prefetch" href="/assets/js/46.f0ad47dd.js"><link rel="prefetch" href="/assets/js/47.1b687bd7.js"><link rel="prefetch" href="/assets/js/48.16105aba.js"><link rel="prefetch" href="/assets/js/49.4c2c2c5e.js"><link rel="prefetch" href="/assets/js/5.5bc5eaa4.js"><link rel="prefetch" href="/assets/js/50.76421ba3.js"><link rel="prefetch" href="/assets/js/51.2f7f6f8b.js"><link rel="prefetch" href="/assets/js/52.4d4ee877.js"><link rel="prefetch" href="/assets/js/53.3c3a975c.js"><link rel="prefetch" href="/assets/js/54.4c9798c7.js"><link rel="prefetch" href="/assets/js/55.46fb092c.js"><link rel="prefetch" href="/assets/js/56.cc9a5bea.js"><link rel="prefetch" href="/assets/js/57.2dfac948.js"><link rel="prefetch" href="/assets/js/58.a1f91605.js"><link rel="prefetch" href="/assets/js/59.dbfdef0b.js"><link rel="prefetch" href="/assets/js/6.e416f727.js"><link rel="prefetch" href="/assets/js/60.a91a795c.js"><link rel="prefetch" href="/assets/js/62.e2ccf952.js"><link rel="prefetch" href="/assets/js/63.2bd0c4cc.js"><link rel="prefetch" href="/assets/js/64.62c29a64.js"><link rel="prefetch" href="/assets/js/65.c110ae95.js"><link rel="prefetch" href="/assets/js/66.8e1a481f.js"><link rel="prefetch" href="/assets/js/67.30980d54.js"><link rel="prefetch" href="/assets/js/68.ba51dd58.js"><link rel="prefetch" href="/assets/js/69.336ac10e.js"><link rel="prefetch" href="/assets/js/7.671bf4d5.js"><link rel="prefetch" href="/assets/js/70.1a2832a2.js"><link rel="prefetch" href="/assets/js/71.5225ac1d.js"><link rel="prefetch" href="/assets/js/72.dd642248.js"><link rel="prefetch" href="/assets/js/73.84d46fc4.js"><link rel="prefetch" href="/assets/js/74.e1e7d470.js"><link rel="prefetch" href="/assets/js/75.2d7155c4.js"><link rel="prefetch" href="/assets/js/76.1b9e602d.js"><link rel="prefetch" href="/assets/js/77.cb915066.js"><link rel="prefetch" href="/assets/js/78.9bfd5a4d.js"><link rel="prefetch" href="/assets/js/79.cea94be8.js"><link rel="prefetch" href="/assets/js/8.c1053140.js"><link rel="prefetch" href="/assets/js/80.dcf79b90.js"><link rel="prefetch" href="/assets/js/81.4bcdd175.js"><link rel="prefetch" href="/assets/js/82.a39c4dd4.js"><link rel="prefetch" href="/assets/js/83.d020fb52.js"><link rel="prefetch" href="/assets/js/84.b656b381.js"><link rel="prefetch" href="/assets/js/85.63f2aab3.js"><link rel="prefetch" href="/assets/js/86.f207c5aa.js"><link rel="prefetch" href="/assets/js/87.4ff13574.js"><link rel="prefetch" href="/assets/js/88.90318af9.js"><link rel="prefetch" href="/assets/js/89.c738a3bb.js"><link rel="prefetch" href="/assets/js/9.25317bd4.js"><link rel="prefetch" href="/assets/js/90.5cfedce5.js"><link rel="prefetch" href="/assets/js/91.65e09223.js"><link rel="prefetch" href="/assets/js/92.af40c683.js"><link rel="prefetch" href="/assets/js/93.3e34cd57.js"><link rel="prefetch" href="/assets/js/94.24583a56.js"><link rel="prefetch" href="/assets/js/95.f3157245.js"><link rel="prefetch" href="/assets/js/96.f12c7c46.js"><link rel="prefetch" href="/assets/js/97.83aad559.js"><link rel="prefetch" href="/assets/js/98.3e876f13.js"><link rel="prefetch" href="/assets/js/99.711d526d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a748b10c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/icon.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分享" class="dropdown-title"><span class="title">技术分享</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术分享" class="mobile-dropdown-title"><span class="title">技术分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/javascript-learning-and-summary/" class="nav-link router-link-active">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/html/html-learning-and-summary/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/css/css-learning-and-summary/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/webpack/webpack-learning-and-summary/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/ts/ts-learning-and-summary/" class="nav-link">
  Typescript
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/nodejs-learning-and-summary/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/weex/weex-learning-and-summary/" class="nav-link">
  Weex
</a></li><li class="dropdown-item"><!----> <a href="/network/network-learning-and-summary/" class="nav-link">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/datastructure/datastructure-learning-and-summary/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/mixin/mixin-learning-and-summary/" class="nav-link">
  日常杂记
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Andraw-lin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分享" class="dropdown-title"><span class="title">技术分享</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术分享" class="mobile-dropdown-title"><span class="title">技术分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/javascript-learning-and-summary/" class="nav-link router-link-active">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/html/html-learning-and-summary/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/css/css-learning-and-summary/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/webpack/webpack-learning-and-summary/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/ts/ts-learning-and-summary/" class="nav-link">
  Typescript
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/nodejs-learning-and-summary/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/weex/weex-learning-and-summary/" class="nav-link">
  Weex
</a></li><li class="dropdown-item"><!----> <a href="/network/network-learning-and-summary/" class="nav-link">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/datastructure/datastructure-learning-and-summary/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/mixin/mixin-learning-and-summary/" class="nav-link">
  日常杂记
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Andraw-lin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/javascript/javascript-learning-and-summary" class="sidebar-heading clickable router-link-active open"><span>JavaScript 学习和总结</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/javascript/javascript-learning-and-summary/脚手架那回事.html" class="sidebar-link">脚手架那回事</a></li><li><a href="/javascript/javascript-learning-and-summary/你搞懂正则了吗.html" class="sidebar-link">你搞懂正则了吗</a></li><li><a href="/javascript/javascript-learning-and-summary/如何优雅地改善程序中for循环.html" class="sidebar-link">如何优雅地改善程序中for循环</a></li><li><a href="/javascript/javascript-learning-and-summary/单点登录的思考.html" class="active sidebar-link">单点登录(SSO)的思考</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/javascript-learning-and-summary/单点登录的思考.html#目录" class="sidebar-link">目录</a></li><li class="sidebar-sub-header"><a href="/javascript/javascript-learning-and-summary/单点登录的思考.html#传统登录和jwt" class="sidebar-link">传统登录和JWT</a></li><li class="sidebar-sub-header"><a href="/javascript/javascript-learning-and-summary/单点登录的思考.html#如何实现单点登录" class="sidebar-link">如何实现单点登录？</a></li></ul></li><li><a href="/javascript/javascript-learning-and-summary/你对同构了解多少.html" class="sidebar-link">你对同构了解多少</a></li><li><a href="/javascript/javascript-learning-and-summary/Javascript 中浮点数的精度问题.html" class="sidebar-link">Javascript中浮点数的精度问题</a></li><li><a href="/javascript/javascript-learning-and-summary/ES6-Summary.html" class="sidebar-link">ES6 Summary</a></li><li><a href="/javascript/javascript-learning-and-summary/ES7-Summary.html" class="sidebar-link">ES7 Summary</a></li><li><a href="/javascript/javascript-learning-and-summary/ES8-Summary.html" class="sidebar-link">ES8 Summary</a></li><li><a href="/javascript/javascript-learning-and-summary/ES9-Summary.html" class="sidebar-link">ES9 Summary</a></li><li><a href="/javascript/javascript-learning-and-summary/ES10-Summary.html" class="sidebar-link">ES10 Summary</a></li><li><a href="/javascript/javascript-learning-and-summary/面向对象编程.html" class="sidebar-link">面向对象编程思想</a></li><li><a href="/javascript/javascript-learning-and-summary/微前端.html" class="sidebar-link">微前端</a></li><li><a href="/javascript/javascript-learning-and-summary/浅拷贝和深拷贝.html" class="sidebar-link">浅拷贝和深拷贝</a></li><li><a href="/javascript/javascript-learning-and-summary/谈谈Vue和React间的区别.html" class="sidebar-link">谈谈Vue和React间的区别</a></li><li><a href="/javascript/javascript-learning-and-summary/移动端适配方案.html" class="sidebar-link">移动端适配方案</a></li><li><a href="/javascript/javascript-learning-and-summary/手写实现那回事.html" class="sidebar-link">手写实现那回事</a></li><li><a href="/javascript/javascript-learning-and-summary/Talking-About-JS-Closures-And-This-Keywords.html" class="sidebar-link">闭包和this指向问题</a></li><li><a href="/javascript/javascript-learning-and-summary/AJAX-Cache-Principle.html" class="sidebar-link">Ajax缓存</a></li><li><a href="/javascript/javascript-learning-and-summary/Memoization-Cache-Mechanism.html" class="sidebar-link">Memoization缓存机制</a></li><li><a href="/javascript/javascript-learning-and-summary/Talk-About-Calls-Apply-And-Bind-In-JavaScript.html" class="sidebar-link">call、apply和bind</a></li><li><a href="/javascript/javascript-learning-and-summary/The-Concrete-Realization-Of-Jsonp.html" class="sidebar-link">JSONP实现</a></li><li><a href="/javascript/javascript-learning-and-summary/Variables-And-Functions-Hosting-In-Javascript.html" class="sidebar-link">变量提升和函数提升</a></li><li><a href="/javascript/javascript-learning-and-summary/On-The-New-Characteristics-Of-Promise.html" class="sidebar-link">Promise特性</a></li><li><a href="/javascript/javascript-learning-and-summary/Talking-About-The-Push-Technology-Of-WEB-Server.html" class="sidebar-link">服务器推送技术</a></li><li><a href="/javascript/javascript-learning-and-summary/AJAX-Cache-Principle.html" class="sidebar-link">Ajax缓存</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="单点登录-sso-的思考"><a href="#单点登录-sso-的思考" class="header-anchor">#</a> 单点登录(SSO)的思考</h1> <p>如果做过大型网站的童鞋们，相信对单点登录肯定不陌生。就好比如天猫和淘宝，当我在淘宝处成功登录之后，再跳去天猫网站，你会发现，在天猫处也会神奇滴登录了。🤔</p> <p>为什么会这样？没错，就是今天的主角——单点登录的“锅”。</p> <p>毫无疑问，对于一个拥有多套子系统的公司来说，单点登录是必须实现的，它不仅可以减少开发者对于各个子系统对应的登录功能维护，还能更好滴提升用户体验。</p> <p>那么问题来了，对于一个单点登录(SSO)的功能实现，可以从哪方面思考呢？下面我们就来一起探讨一下啦...</p> <h2 id="目录"><a href="#目录" class="header-anchor">#</a> 目录</h2> <ol><li><a href="#s1">传统登录和JWT</a></li> <li><a href="#s2">如何实现单点登录？</a></li></ol> <h2 id="传统登录和jwt"><a href="#传统登录和jwt" class="header-anchor">#</a> 传统登录和JWT</h2> <p>在讲解之前，我觉得是很有必要提提登录的基本实现的。就好比如，如果我要让你实现一个登录功能，你会如何实现呢？</p> <p>相信很多童鞋都会知道使用 Session 和 Cookie 实现，那么还有吗？哈哈，相信你也能看到，就是时下最为常用方式 JWT。那么问题来了，它们之间有什么区别？甭急，下面将会简单讲解一下。</p> <blockquote><p>传统登录</p></blockquote> <p><strong>传统登录的实现其实就是使用 Session 和 Cookie 的</strong>，那先看看它们的处理流程是怎样。</p> <ol><li>客户端发送登录请求到服务器。</li> <li>服务器将会根据客户端传过来的用户名和密码创建一个 session，session 中存储了相应用户角色、登陆时间等等信息。</li> <li>服务器向客户端返回一个 sessionid，并写入客户端的 cookie（cookie 其实就相当于是一个用户凭证）。</li> <li>客户端接下来的每次请求都会默认带上 cookie ，相当于将 sessionid 传回服务器。</li> <li>服务器收到 sessionid，会找到前期保存的数据，由此得知用户的身份。</li></ol> <p><strong>利用 Session 和 Cookie 技术实现的传统登录功能</strong>，过程并不难理解，简单滴说，<strong>就是服务端负责管理用户状态和验证，而客户端则负责存储用户状态</strong>。</p> <p>那么问题来了，服务端返回的 SessionId 一定是要使用 Cookie 存储吗？还是说可以存储在 SessionStorage 或者 LocalStorange 上？🤔</p> <p>对于这个问题，其实也是我一直思考的，定性思考一番，其实也是有它的目的。首先可以明确的是，<strong>服务端返回的 SessionId 不一定要使用 Cookie 进行存储的，可以使用诸如 SessionStorage、LocalStorage 等方式进行存储的</strong>。</p> <p>那么使用 Cookie 存储服务端返回的 SessionID 有什么好处？主要是为了减轻前端开发者负担，由于服务端可以直接通过设置返回头 Set-Cookie 来直接在客户端的 Cookie 中存储 SessionId。这样一来，客户端就可以免去了手动保存 SessionId 的步骤，直接处理相应登录业务逻辑即可。</p> <p>虽然使用 Cookie 可以很方便开发者的存储相应的用户状态，但是却会导致诸如 XSS、 CSRF 等安全性问题。</p> <blockquote><p>JWT</p></blockquote> <p>使用 Session 和 Cookie 技术实现的登录功能依然存在着缺陷。</p> <p>首先就是 <strong>Cookie 允许被用户禁止</strong>，当一个浏览器禁止使用 Cookie 后，那么服务器中存储的 Session 也被禁止，直接导致相应的用户无法进行登录。另外，当用户访问量很大时，对服务器的压力也会大，因为<strong>用户访问量大将会触使服务器需要管理大量用户的 Session</strong>，想象一下，访问量达到亿级别时会怎样？毫无疑问，服务器管理的 Session 越多，对服务器本身压力也会大。</p> <p>那么，有没有一种方式可以克服以上的缺陷呢？有～那便是 JWT。</p> <p>JWT 是 Json Web Token 的缩写，一个规范用于用户和服务器之间传递安全可靠的信息。（简单滴说，就是所谓的 Token 机制）。让我们先看看 Token 机制的处理流程。</p> <ol><li>客户端发送请求到服务器。</li> <li>服务返回一个经过加密的token，并由客户端负责存储，可存到 local storage 或 cookie。</li> <li>客户端接下来的每次请求，都需要手动加上该 token。</li> <li>服务器对 token 进行解码，如果 token 有效，则处理请求。</li> <li>一旦用户登出，客户端就需要销毁 token。</li></ol> <p><strong>Token 机制相对于传统登录方式的最大区别就是，所有的用户状态都交给客户端进行管理和存储</strong>。</p> <p>Token 可以看成是一张门票，当你想去看演唱会时，那必须得先展示门票。</p> <p>一个 JWT 实际上就是一串字符串，由三部分组成，分别是</p> <ul><li>头部 Header：指定了 JWT 使用的签名算法。</li> <li>消息体 Payload：包含了签名信息。</li> <li>签名 Signature：使用 base64url 编码的头信息和消息体拼接（使用.分隔）再通过私有的 secret 计算而来。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 一个完整的Token可表示为</span>
Token <span class="token operator">=</span> <span class="token function">encodeBase64</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> <span class="token function">encodeBase64</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> <span class="token function">encodeBase64</span><span class="token punctuation">(</span>signature<span class="token punctuation">)</span>
</code></pre></div><p>Token 机制由于无需在服务端管理用户状态，因此极大滴减轻了服务器的压力，另一方面，由于在登录后的任何请求，都不会再在请求中带上用户标识，这样一来，就可以极大滴避免 CSRF 攻击。</p> <h2 id="如何实现单点登录"><a href="#如何实现单点登录" class="header-anchor">#</a> 如何实现单点登录？</h2> <p>在大型网站下，实现单点登录变得越来越重要，那么要实现单点登录具体有哪些方案呢？</p> <p>要实现单点登录，个人总结认为，主要有 <strong>Session 共享机制、Cookie 跨域处理、CAS 服务</strong> 三种方案。（当然可能还有其他方案，欢迎各位大佬们来分享分享啦 😄）。那么我们就来简单分析一下。</p> <p>Session 共享的实现，大部分工作都是需要后端配合的，一般涉及到集群方面等，当然如果使用的是 Node的话，可以使用 Redis 实现，将所有的 Session 都放在中间层管理。</p> <p>下面就讲讲 Cookie 跨域处理和 CAS 服务两种方案，这两种方案也是前端开发者常常需要考虑的方案啦。</p> <blockquote><p>Cookie 跨域处理</p></blockquote> <p>如果你使用过 Cookie 的话，肯定会知道 Domain 。那么 Domain 究竟是拿来干嘛的？</p> <p><strong>Cookie 中 Domain 就是拿来约束使用 Cookie 的域名管理</strong>。举个例子，如果网站<code>a.test.com</code>和<code>b.test.com</code>是可以通过 Cookie 进行通信的，因为 Domain 会被设置为<code>test.com</code>，相反如果网站<code>a.test.com</code>和<code>c.haha.com</code>就无法通过 Cookie 进行通信，因为网站<code>c.haha.com</code>无法受到 Domain 限制而无法获取相应的 Cookie 值。</p> <p>先回顾一下跨域的同源政策，<strong>只有同协议、同域名、同端口才符合同源政策</strong>。</p> <p>那么在跨域情况下，需要如何让 Cookie 进行通信呢？</p> <ol><li><p>当用户在网站<code>a.test.com</code>进行登录，后端根据用户名和密码判断该用户是网站<code>c.haha.com</code>中用户，会先在<code>a.test.com</code>登录后再返回标识给客户端。</p></li> <li><p>客户端先配置好 axios 的请求头部字段<code>withCredentials</code>为 true。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">true</span>
</code></pre></div><p>同时，运维需要在 Ngix 中配置接口允许 CORS，并且设置相应的响应头部字段。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>access<span class="token operator">-</span>control<span class="token operator">-</span>allow<span class="token operator">-</span>credentials<span class="token operator">:</span> <span class="token boolean">true</span>
access<span class="token operator">-</span>control<span class="token operator">-</span>allow<span class="token operator">-</span>origin<span class="token operator">:</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>a<span class="token punctuation">.</span>test<span class="token punctuation">.</span>com
</code></pre></div><p>必须要注意的是，<strong>CORS 在允许跨域处理 Cookie 时绝对不能设置 access-control-allow-origin 值为 *，只能针对性的域名</strong>。</p></li> <li><p>客户端根据标识调用相应网站的登录接口（如<code>c.haha.com/ligon</code>）去登录，登录成功后，后端会在<code>c.haha.com</code>的 Cookie 中存储 Token 值（此时还是在网站<code>a.test.com</code>中），这时候就可以跳转到<code>c.haha.com</code>主页。</p></li> <li><p>去到<code>c.haha.com</code>主页后，获取相应 Cookie 中 Token 值配置在请求头部字段 <strong>authorization</strong>中，便可实现单点登录功能。</p></li></ol> <p>在上面的基本流程中，相信你肯定会有问题，甭急，让我们一个个来解决。</p> <p><strong>在 axios 的请求头部字段设置<code>withCredentials</code>的值为 true 有何用？</strong></p> <p>其实，<strong><code>withCredentials</code>字段用于允许跨域处理 Cookie</strong>。但是单纯配置它是没法起效果的，<strong>必须要结合运维在响应头部加上 access-control-allow-credentials 和 access-control-allow-origin 两个字段才能起效果</strong>。</p> <p><strong>既然在 CORS 中的 access-control-allow-origin 响应字段必须为针对性的域名而不能设置为 *，那么在本地开发时，如何配置？</strong></p> <p>要处理这个问题，有两种方案，<strong>一种是在 access-control-allow-origin 响应字段中增添一个域名为 localhost。另一种则是配置 webpack-dev-server 中 proxy</strong>，如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'/test/login'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      traget<span class="token operator">:</span> <span class="token string">'http://c.haha.com/login'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">onProxyRes</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">proxyRes<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 接口返回中间层处理</span>
      <span class="token comment">// 针对c.haha.com/login登录接口返回手动存储cookie</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>时下，使用 Cookie 跨域处理是改动最小方案，也是目前最优的选择方案。</p> <blockquote><p>CAS 服务</p></blockquote> <p>CAS 服务，相当于所有的网站的登录服务，都统一使用一个登录网站处理。</p> <p><strong>CAS 分为两部分，分别是 CAS Client（中间登录客户端）和 CAS Server（登录处理服务器）</strong>。在现实生活中还是挺多使用到 CAS 的，例如淘宝和天猫网站便是，未登录情况下，无论在淘宝上还是在天猫上点击登录都会跳去相同的登录页面，而这个登录页面其实就是 CAS Client。当登录成功后，会发现无论是在天猫还是淘宝都会是登录状态。</p> <p>在了解 CAS 服务前，需提前了解以下几个知识点。</p> <ul><li><p>TCT（Ticket Granting ticket 缩写）</p> <p>可比作是一个 Session，CAS Server 会根据用户名和密码生成一个 TGT。</p></li> <li><p>TGC（Ticket-granting cookie 缩写）</p> <p>其实就是一个 Cookie，用于存放用户身份信息。</p></li> <li><p>ST（Service ticket 缩写）</p> <p>可简单比作是一个 SessionId，一次性票据，用于验证用的，只能用一次，可以想象成服务端发送给客户端的一张门票。</p></li></ul> <p>接下来，我们就来瞅瞅，CAS 服务的流程是如何的。</p> <ol><li><p>用户第一次访问<code>a.test.com</code>网站时，点击登录会重定向到 CAS Server，发现请求中没有 Cookie，那么便会返回状态 302，重定向到 CAS Client 登录页面。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>cas<span class="token punctuation">.</span>com<span class="token operator">/</span>login<span class="token operator">?</span>previosurl<span class="token operator">=</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>a<span class="token punctuation">.</span>test<span class="token punctuation">.</span>com
</code></pre></div></li> <li><p>在 CAS Client 中输入用户名和密码并且点击提交后，CAS Server便会生成一个 TGT，再用 TGT 生成一个 ST，然后便会在返回头中 Set-Cookie ，在客户端 Cookie 中存储 ST。</p></li> <li><p>存储成功后，便重新回到上面的 previosurl 中，并带上一个 ticket 参数（用于后端验证用的）。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>a<span class="token punctuation">.</span>test<span class="token punctuation">.</span>com<span class="token operator">?</span>ticket<span class="token operator">=</span><span class="token constant">ST</span><span class="token operator">-</span><span class="token number">123456</span><span class="token operator">-</span>asdasd4fas23qf8
</code></pre></div><p>ticket 后面的值就是 ST。</p></li> <li><p>回到<code>a.test.com</code>网站后，将参数 ticket 传递给服务端，服务端会将 ticket 拿到 CAS Server 进行验证，验证通过后便会返回登录成功。</p></li> <li><p>用户第一次访问<code>c.haha.com</code>后，点击登录同样会重定向到 CAS Server 中，这时候由于上一次已经在 CAS Client 客户端的 Cookie 中存储了 ST，所以 CAS Server 会发现请求头部已经带上了上一次登录的 ST，这时候便会直接同定向回<code>c.haha.com</code>中，并且带上参数<code>ticket</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>c<span class="token punctuation">.</span>haha<span class="token punctuation">.</span>com<span class="token operator">?</span>ticket<span class="token operator">=</span><span class="token constant">ST</span><span class="token operator">-</span><span class="token number">123456</span><span class="token operator">-</span>asdasd4fas23qf8
</code></pre></div></li> <li><p>回到<code>c.haha.com</code>后，同样会拿 ticket 传递到服务端，服务端拿到 ticket 后便会再次拿到 CAS Server 中进行验证，验证通过便会成功登录。至此，一个单点登录功能便实现。</p></li></ol> <p>可以看到的是，<strong>CAS 服务原理就是利用中间客户端 CAS Client 复用 Cookie 值实现单点登录功能</strong>。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/javascript/javascript-learning-and-summary/如何优雅地改善程序中for循环.html" class="prev">
        如何优雅地改善程序中for循环
      </a></span> <span class="next"><a href="/javascript/javascript-learning-and-summary/你对同构了解多少.html">
        你对同构了解多少
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.62b9dc26.js" defer></script><script src="/assets/js/2.1177bb59.js" defer></script><script src="/assets/js/61.bc1f5260.js" defer></script>
  </body>
</html>
